<html><head><base href="https://docs.google.com/spreadsheets/d/1IyjmrXPpIgrQS7Cfhifoj3BGrP7c708ToWy4xoi0pDs/edit?gid=0#gid=0">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRM - GestiÃ³n de Clientes</title>
<link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f0f0f0;
  }
  .menu-container {
    width: 200px;
    background-color: #333;
    height: 100vh;
    color: white;
    padding-top: 20px;
    position: fixed;
    left: 0;
    top: 0;
  }
  .menu-item {
    padding: 15px 20px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .menu-item:hover {
    background-color: #555;
  }
  .menu-item.active {
    background-color: #4CAF50;
  }
  .content {
    margin-left: 200px;
    padding: 20px;
    margin-bottom: 60px;
  }
  h1 {
    color: #333;
    margin-bottom: 20px;
  }
  .spreadsheet {
    background-color: white;
    border: 1px solid #ccc;
    overflow-x: auto;
  }
  .tabs {
    display: flex;
    background-color: #f1f1f1;
    border-bottom: 1px solid #ccc;
  }
  .tab {
    padding: 10px 20px;
    cursor: pointer;
    border-right: 1px solid #ccc;
  }
  .tab.active {
    background-color: white;
    border-bottom: 2px solid #4CAF50;
  }
  table {
    border-collapse: collapse;
    width: 100%;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }
  th {
    background-color: #f2f2f2;
    font-weight: bold;
  }
  .cell {
    min-width: 100px;
  }
  .cell:focus {
    outline: 2px solid #4CAF50;
  }
  .add-client {
    position: fixed;
    bottom: 80px;
    right: 20px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #4CAF50;
    color: white;
    font-size: 30px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }
  .add-client:hover {
    background-color: #45a049;
    box-shadow: 0 6px 8px rgba(0,0,0,0.15);
    transform: translateY(-2px);
  }
  .add-separator {
    position: fixed;
    bottom: 150px;
    right: 20px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #333;
    color: white;
    font-size: 30px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }
  .add-separator:hover {
    background-color: #555;
    box-shadow: 0 6px 8px rgba(0,0,0,0.15);
    transform: translateY(-2px);
  }
  .separator-row {
    background-color: #333;
    color: white;
    font-weight: bold;
  }
  .separator-row td {
    padding: 10px;
  }
  .remove-separator {
    width: 30px;
  }
  .remove-separator-btn {
    background-color: #ff4136;
    color: white;
    border: none;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 16px;
    line-height: 1;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.3s ease;
  }
  .remove-separator-btn:hover {
    background-color: #ff1a1a;
    transform: scale(1.1);
  }
  .row-number {
    background-color: #f2f2f2;
    font-weight: bold;
    text-align: center;
    width: 40px;
  }
  .client-name {
    cursor: default;
    color: #1a73e8;
    text-decoration: underline;
  }
  .client-name:hover {
    color: #174ea6;
  }
  .bio-display {
    position: fixed;
    right: 20px;
    top: 80px;
    width: 400px;
    background-color: white;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  .bio-display h3 {
    margin-top: 0;
    color: #333;
  }
  .bio-display p {
    color: #666;
    line-height: 1.6;
  }
  .profile-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
  }
  .profile-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #4CAF50;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    color: white;
    margin-right: 15px;
  }
  .profile-name {
    font-size: 20px;
    font-weight: bold;
  }
  .profile-info {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 15px;
  }
  .profile-field {
    font-size: 14px;
  }
  .profile-field-label {
    font-weight: bold;
    color: #555;
  }
  .profile-bio {
    font-size: 14px;
    color: #666;
    line-height: 1.6;
  }
  .gauge-container {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
  }
  .gauge {
    width: 100px;
    text-align: center;
  }
  .gauge svg {
    width: 100%;
    height: auto;
  }
  .gauge-bg {
    fill: none;
    stroke: #e0e0e0;
    stroke-width: 10;
  }
  .gauge-fill {
    fill: none;
    stroke: #2196F3;
    stroke-width: 10;
    transform: rotate(-90deg);
    transform-origin: center;
    transition: stroke-dasharray 0.3s ease;
  }
  .gauge text {
    font-size: 24px;
    font-weight: bold;
    fill: #333;
  }
  .gauge-label {
    margin-top: 5px;
    font-size: 14px;
    color: #666;
  }
  .gauge:nth-child(2) .gauge-fill {
    stroke: #F44336;
  }
  .gauge:nth-child(3) .gauge-fill {
    stroke: #4CAF50;
  }
  .timeline {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e0e0e0;
    overflow-x: auto;
    width: 100%;
  }
  .timeline h4 {
    margin-bottom: 15px;
    color: #333;
  }
  .timeline-events {
    list-style-type: none;
    padding-left: 0;
    display: flex;
    position: relative;
    width: max-content;
    padding-bottom: 10px;
  }
  .timeline-events::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    right: 0;
    height: 2px;
    background-color: #e0e0e0;
    transform: translateY(-50%);
  }
  .timeline-event {
    position: relative;
    padding-top: 20px;
    margin-right: 40px;
    flex: 0 0 auto;
    width: 140px;
  }
  .timeline-event::before {
    content: '';
    position: absolute;
    left: 50%;
    top: 0;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #4CAF50;
    transform: translateX(-50%);
  }
  .timeline-date {
    font-size: 12px;
    color: #888;
    margin-bottom: 5px;
    text-align: center;
  }
  .timeline-content {
    font-size: 14px;
    color: #333;
    text-align: center;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 600px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .close:hover,
  .close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
  }
  .bottom-tabs {
    position: fixed;
    bottom: 0;
    left: 200px;
    right: 0;
    display: flex;
    background-color: #f0f0f0;
    border-top: 1px solid #ccc;
    z-index: 1000;
  }
  .bottom-tabs .tab {
    flex: 1;
    text-align: center;
    padding: 15px 0;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
  }
  .bottom-tabs .tab[data-tab="mesa"] { background-color: #FF9800; color: white; }
  .bottom-tabs .tab[data-tab="clientes"] { background-color: #2196F3; color: white; }
  .bottom-tabs .tab[data-tab="riders"] { background-color: #4CAF50; color: white; }
  .bottom-tabs .tab[data-tab="fijos"] { background-color: #9C27B0; color: white; }
  .bottom-tabs .tab[data-tab="web"] { background-color: #F44336; color: white; }
  .bottom-tabs .tab:hover {
    filter: brightness(1.1);
  }
  .bottom-tabs .tab.active {
    box-shadow: inset 0 -4px 0 white;
  }
  .pinned-note-btn {
    background-color: #ffd700;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50% 50% 50% 0;
    transform: rotate(-45deg);
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
  }
  .pinned-note-btn:hover {
    background-color: #ffc700;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }
  .pinned-note-btn::before {
    content: "ðŸ“Œ";
    font-size: 16px;
    transform: rotate(45deg);
  }
  .sticky-note {
    display: none;
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 250px;
    height: 250px;
    padding: 25px;
    background-color: #fef9c3;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    font-family: 'Permanent Marker', cursive;
    font-size: 16px;
    line-height: 1.5;
    color: #333;
    z-index: 1001;
    overflow-y: auto;
    transition: all 0.3s ease;
    background-image: 
      linear-gradient(to right, rgba(0,0,0,0.05) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px);
    background-size: 10px 10px;
    transform-origin: center;
  }
  .sticky-note::before {
    content: '';
    position: absolute;
    top: -10px;
    left: 50%;
    width: 40px;
    height: 20px;
    background-color: rgba(255,255,255,0.5);
    border: 2px solid rgba(0,0,0,0.1);
    transform: translateX(-50%) rotate(-5deg);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  .sticky-note.show {
    display: block;
    animation: popIn 0.3s ease-out;
  }
  @keyframes popIn {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }
  .estado-dropdown {
    width: 100%;
    padding: 5px;
    border: none;
    border-radius: 4px;
    color: white;
    font-weight: bold;
    cursor: pointer;
  }
  .estado-en-proceso { background-color: #FFA500; }
  .estado-completado { background-color: #4CAF50; }
  .estado-pendiente { background-color: #2196F3; }
  .estado-cancelado { background-color: #F44336; }
  .estado-en-espera { background-color: #9C27B0; }
  .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 24px;
    cursor: pointer;
    color: #333;
  }
  .close-btn:hover {
    color: #f44336;
  }
  .edit-btn {
    position: absolute;
    top: 10px;
    right: 40px;
    font-size: 24px;
    cursor: pointer;
    color: #333;
    transition: all 0.3s ease;
  }
  .edit-btn:hover {
    color: #2196F3;
    transform: scale(1.1);
  }
  .edit-btn svg {
    filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
  }
  .dashboard {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 30px;
  }
  .dashboard-card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    text-align: center;
    transition: all 0.3s ease;
  }
  .dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
  }
  .dashboard-card h3 {
    margin: 0 0 10px;
    color: #333;
    font-size: 1.2em;
  }
  .dashboard-card .amount {
    font-size: 2em;
    font-weight: bold;
    color: #2196F3;
  }
  .dashboard-card.total-due .amount {
    color: #F44336;
  }
  .dashboard-graph {
    grid-column: 1 / -1;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  #dashboardChart {
    width: 100%;
    height: 300px;
  }
  .draggable-row, .separator-row {
    cursor: move;
  }
  .draggable-row.dragging, .separator-row.dragging {
    opacity: 0.5;
    background-color: #f0f0f0;
  }
  .drop-zone {
    border-top: 2px solid #4CAF50;
  }
</style>
</head>
<body>
<div id="app">
  <div class="menu-container">
    <div class="menu-item" @click="setActiveItem('dashboard')" :class="{ active: activeItem === 'dashboard' }">
      Dashboard
    </div>
    <div class="menu-item" @click="setActiveItem('clientes')" :class="{ active: activeItem === 'clientes' }">
      Clientes
    </div>
    <div class="menu-item" @click="setActiveItem('tramites')" :class="{ active: activeItem === 'tramites' }">
      TrÃ¡mites
    </div>
    <div class="menu-item" @click="setActiveItem('reportes')" :class="{ active: activeItem === 'reportes' }">
      Reportes
    </div>
    <div class="menu-item" @click="setActiveItem('configuracion')" :class="{ active: activeItem === 'configuracion' }">
      ConfiguraciÃ³n
    </div>
  </div>

  <div class="content">
    <h1>{{ activeItemTitle }}</h1>
    <div v-if="activeItem === 'dashboard'" class="dashboard">
      <div class="dashboard-card total-paid">
        <h3>Total Pagado</h3>
        <div class="amount">{{ totalPaid }}</div>
      </div>
      <div class="dashboard-card total-due">
        <h3>Total Adeudado</h3>
        <div class="amount">{{ totalDue }}</div>
      </div>
      <div class="dashboard-card total-procedures">
        <h3>Total TrÃ¡mites</h3>
        <div class="amount">{{ totalProcedures }}</div>
      </div>
      <div class="dashboard-graph">
        <canvas id="dashboardChart"></canvas>
      </div>
    </div>
    <div v-if="activeItem === 'clientes'" class="spreadsheet">
      <div class="tabs">
        <div v-for="tab in tabs" :key="tab" @click="activeTab = tab" :class="['tab', { active: activeTab === tab }]">
          {{ tab }}
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th class="row-number">#</th>
            <th v-for="column in columns" :key="column">{{ column }}</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(row, index) in rows" :key="row" :data-row-id="row" :class="['draggable-row', { 'separator-row': isSeparatorRow(row) }]" :draggable="true">
            <td class="row-number">{{ row }}</td>
            <td v-for="column in columns" :key="column">
              <div v-if="column === 'Nombre' && !isSeparatorRow(row)" class="cell client-name" 
                   @mouseover="showClientBio(row, column)" 
                   @mouseleave="hideClientBio"
                   @click="showClientBio(row, column, $event)">
                {{ getCellValue(row, column) }}
              </div>
              <div v-else-if="column === 'Tareas' && !isSeparatorRow(row)" class="cell">
                <button class="pinned-note-btn" 
                        @click="handleTasks(row)" 
                        @mouseover="showStickyNoteHandler" 
                        @mouseleave="hideStickyNoteHandler"></button>
              </div>
              <div v-else-if="column === 'Estado' && !isSeparatorRow(row)" class="cell">
                <select class="estado-dropdown" @change="updateCell(row, column, $event)">
                  <option v-for="estado in estadoOptions" :key="estado" :value="estado" :class="'estado-option estado-' + estado.toLowerCase().replace(' ', '-')">
                    {{ estado }}
                  </option>
                </select>
              </div>
              <div v-else-if="isSeparatorRow(row) && column === 'Importe'" class="cell">
                {{ getCellValue(row, column) }}
              </div>
              <div v-else-if="!isSeparatorRow(row)" class="cell" contenteditable="true" @blur="updateCell(row, column, $event)">
                {{ getCellValue(row, column) }}
              </div>
            </td>
            <td v-if="isSeparatorRow(row)" class="remove-separator">
              <button @click="removeSeparatorRow(row)" class="remove-separator-btn" title="Remove separator">Ã—</button>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="bio-display" v-if="hoveredClient || fixedClientBio">
        <div class="close-btn" v-if="fixedClientBio" @click="closeFixedBio">Ã—</div>
        <div class="edit-btn" @click="editClientBio" title="Edit client info">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            <path d="M15 5l4 4"></path>
          </svg>
        </div>
        <div class="profile-header">
          <div class="profile-avatar">{{ getInitials((fixedClientBio || hoveredClient).Nombre) }}</div>
          <div class="profile-name">{{ (fixedClientBio || hoveredClient).Nombre }}</div>
        </div>
        <div class="profile-info">
          <div class="profile-field">
            <div class="profile-field-label">CUIT</div>
            <div>{{ (fixedClientBio || hoveredClient).CUIT }}</div>
          </div>
          <div class="profile-field">
            <div class="profile-field-label">WhatsApp</div>
            <div>{{ (fixedClientBio || hoveredClient).WhatsApp }}</div>
          </div>
          <div class="profile-field">
            <div class="profile-field-label">TrÃ¡mite</div>
            <div>{{ (fixedClientBio || hoveredClient).TrÃ¡mite }}</div>
          </div>
          <div class="profile-field">
            <div class="profile-field-label">Estado</div>
            <div>{{ (fixedClientBio || hoveredClient).Estado }}</div>
          </div>
        </div>
        <div class="profile-bio">
          <strong>Bio:</strong> {{ (fixedClientBio || hoveredClient).Bio }}
        </div>
        <div class="gauge-container">
          <div class="gauge">
            <svg viewBox="0 0 100 100">
              <circle class="gauge-bg" cx="50" cy="50" r="45"></circle>
              <circle class="gauge-fill" cx="50" cy="50" r="45" :style="{ strokeDasharray: `${(fixedClientBio || hoveredClient).totalProceduresPercentage} 283` }"></circle>
              <text x="50" y="50" text-anchor="middle" dominant-baseline="central">{{ (fixedClientBio || hoveredClient).totalProcedures }}</text>
            </svg>
            <div class="gauge-label">TrÃ¡mites</div>
          </div>
          <div class="gauge">
            <svg viewBox="0 0 100 100">
              <circle class="gauge-bg" cx="50" cy="50" r="45"></circle>
              <circle class="gauge-fill" cx="50" cy="50" r="45" :style="{ strokeDasharray: `${(fixedClientBio || hoveredClient).totalDuePercentage} 283` }"></circle>
              <text x="50" y="50" text-anchor="middle" dominant-baseline="central">{{ (fixedClientBio || hoveredClient).totalDue }}</text>
            </svg>
            <div class="gauge-label">Debe</div>
          </div>
          <div class="gauge">
            <svg viewBox="0 0 100 100">
              <circle class="gauge-bg" cx="50" cy="50" r="45"></circle>
              <circle class="gauge-fill" cx="50" cy="50" r="45" :style="{ strokeDasharray: `${(fixedClientBio || hoveredClient).totalPaidPercentage} 283` }"></circle>
              <text x="50" y="50" text-anchor="middle" dominant-baseline="central">{{ (fixedClientBio || hoveredClient).totalPaid }}</text>
            </svg>
            <div class="gauge-label">Pagado</div>
          </div>
        </div>
        <div class="timeline">
          <h4>Timeline</h4>
          <div class="timeline-events">
            <div v-for="event in (fixedClientBio || hoveredClient).timeline" :key="event.date" class="timeline-event">
              <div class="timeline-date">{{ event.date }}</div>
              <div class="timeline-content">{{ event.description }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div v-else>
      <p>Contenido del {{ activeItem }} irÃ¡ aquÃ­.</p>
    </div>
  </div>

  <div class="bottom-tabs">
    <div class="tab" data-tab="mesa">Mesa</div>
    <div class="tab" data-tab="clientes">Clientes</div>
    <div class="tab" data-tab="riders">Riders</div>
    <div class="tab" data-tab="fijos">Fijos</div>
    <div class="tab" data-tab="web">Web</div>
  </div>

  <div class="add-client" @click="addRow" title="Agregar cliente">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="5" x2="12" y2="19"></line>
      <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg>
  </div>
  
  <div class="add-separator" @click="addSeparatorRow" title="Agregar separador">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg>
  </div>
  
  <div class="sticky-note" :class="{ show: showStickyNote }">
    {{ stickyNoteContent }}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Vue({
  el: '#app',
  data: {
    activeItem: 'clientes',
    activeTab: 'Clientes Activos',
    activeBottomTab: 'mesa',
    fixedClientBio: null,
    totalPaid: '$150,000',
    totalDue: '$25,000',
    totalProcedures: 145,
    tabs: ['Clientes Activos', 'Clientes Inactivos', 'Prospectos'],
    columns: ['Fecha', 'Nombre', 'CUIT', 'WhatsApp', 'Detalle', 'TrÃ¡mite', 'Importe', 'Estado', 'Seguimiento', 'Tareas'],
    cellData: {},
    rows: 20,
    selectedClient: {},
    clientBios: {},
    hoveredClient: null,
    estadoOptions: ['En proceso', 'Completado', 'Pendiente', 'Cancelado', 'En espera'],
    showStickyNote: false,
    stickyNoteContent: '',
    separatorRows: [],
  },
  computed: {
    activeItemTitle() {
      const titles = {
        dashboard: 'Dashboard',
        clientes: 'GestiÃ³n de Clientes',
        tramites: 'GestiÃ³n de TrÃ¡mites',
        reportes: 'Reportes y AnÃ¡lisis',
        configuracion: 'ConfiguraciÃ³n del Sistema'
      };
      return titles[this.activeItem];
    },
    clientInitials() {
      if (this.selectedClient.Nombre) {
        return this.selectedClient.Nombre.split(' ').map(n => n[0]).join('').toUpperCase();
      }
      return '';
    }
  },
  methods: {
    setActiveItem(item) {
      this.activeItem = item;
    },
    setActiveBottomTab(tab) {
      this.activeBottomTab = tab;
    },
    updateCell(row, column, event) {
      const value = event.target.value || event.target.textContent;
      if (!this.cellData[this.activeTab]) {
        this.cellData[this.activeTab] = {};
      }
      if (!this.cellData[this.activeTab][row]) {
        this.cellData[this.activeTab][row] = {};
      }
      this.cellData[this.activeTab][row][column] = value;

      // Update the dropdown color for the "Estado" column
      if (column === 'Estado') {
        event.target.className = 'estado-dropdown estado-' + value.toLowerCase().replace(' ', '-');
      }

      // Only recalculate if it's not a separator row update
      if (!this.separatorRows.includes(row)) {
        this.$nextTick(() => {
          this.recalculateSeparatorSums();
        });
      }
    },
    calculateSeparatorSum(separatorRowId) {
      let sum = 0;
      const rows = Array.from(document.querySelectorAll('table tbody tr'));
      const separatorIndex = rows.findIndex(row => parseInt(row.dataset.rowId) === separatorRowId);
      
      for (let i = separatorIndex - 1; i >= 0; i--) {
        const rowId = parseInt(rows[i].dataset.rowId);
        if (this.separatorRows.includes(rowId)) break;
        const estado = this.getCellValue(rowId, 'Estado');
        if (estado === 'Completado') {
          const importe = this.getCellValue(rowId, 'Importe');
          sum += parseFloat(importe.replace('$', '').replace(',', '')) || 0;
        }
      }

      // Instead of calling updateCell, directly update the cellData
      if (!this.cellData[this.activeTab]) {
        this.cellData[this.activeTab] = {};
      }
      if (!this.cellData[this.activeTab][separatorRowId]) {
        this.cellData[this.activeTab][separatorRowId] = {};
      }
      this.cellData[this.activeTab][separatorRowId]['Importe'] = `$${sum.toFixed(2)}`;

      // Force a re-render of the specific cell
      this.$forceUpdate();
    },
    getCellValue(row, column) {
      if (this.cellData[this.activeTab] && this.cellData[this.activeTab][row] && this.cellData[this.activeTab][row][column]) {
        return this.cellData[this.activeTab][row][column];
      }
      return this.generateRandomData(column);
    },
    addRow() {
      this.rows++;
    },
    addSeparatorRow() {
      const newRowId = this.rows + 1;
      this.separatorRows.push(newRowId);
      this.rows++;
      this.$nextTick(() => {
        this.calculateSeparatorSum(newRowId);
      });
    },
    removeSeparatorRow(rowId) {
      const index = this.separatorRows.indexOf(rowId);
      if (index > -1) {
        this.separatorRows.splice(index, 1);
        this.rows = this.rows.filter(row => row !== rowId);
        this.$nextTick(() => {
          this.recalculateSeparatorSums();
        });
      }
    },
    calculateSeparatorSum(separatorRowId) {
      let sum = 0;
      const rows = Array.from(document.querySelectorAll('table tbody tr'));
      const separatorIndex = rows.findIndex(row => parseInt(row.dataset.rowId) === separatorRowId);
      
      for (let i = separatorIndex - 1; i >= 0; i--) {
        const rowId = parseInt(rows[i].dataset.rowId);
        if (this.separatorRows.includes(rowId)) break;
        const estado = this.getCellValue(rowId, 'Estado');
        if (estado === 'Completado') {
          const importe = this.getCellValue(rowId, 'Importe');
          sum += parseFloat(importe.replace('$', '').replace(',', '')) || 0;
        }
      }

      if (!this.cellData[this.activeTab]) {
        this.cellData[this.activeTab] = {};
      }
      if (!this.cellData[this.activeTab][separatorRowId]) {
        this.cellData[this.activeTab][separatorRowId] = {};
      }
      this.cellData[this.activeTab][separatorRowId]['Importe'] = `$${sum.toFixed(2)}`;

      this.$forceUpdate();
    },
    isSeparatorRow(row) {
      return this.separatorRows.includes(row);
    },
    generateRandomData(column) {
      switch(column) {
        case 'Fecha':
          return this.randomDate(new Date(2023, 0, 1), new Date());
        case 'Nombre':
          return this.randomName();
        case 'CUIT':
          return this.randomCUIT();
        case 'WhatsApp':
          return this.randomWhatsApp();
        case 'Detalle':
          return this.randomDetail();
        case 'TrÃ¡mite':
          return this.randomProcedure();
        case 'Importe':
          return this.randomAmount();
        case 'Estado':
          return this.randomStatus();
        case 'Seguimiento':
          return this.randomFollowUp();
        case 'Tareas':
          return '';
        default:
          return '';
      }
    },
    randomDate(start, end) {
      const date = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
      return date.toLocaleDateString('es-AR');
    },
    randomName() {
      const names = ['Juan PÃ©rez', 'MarÃ­a GonzÃ¡lez', 'Carlos RodrÃ­guez', 'Ana MartÃ­nez', 'Luis GarcÃ­a', 'Laura LÃ³pez', 'Pedro SÃ¡nchez', 'SofÃ­a Romero', 'Diego FernÃ¡ndez', 'Valentina Torres'];
      return names[Math.floor(Math.random() * names.length)];
    },
    randomCUIT() {
      return '20-' + Math.floor(10000000 + Math.random() * 90000000) + '-' + Math.floor(Math.random() * 10);
    },
    randomWhatsApp() {
      return '+54 9 11 ' + Math.floor(1000 + Math.random() * 9000) + '-' + Math.floor(1000 + Math.random() * 9000);
    },
    randomDetail() {
      const details = ['Consulta general', 'ActualizaciÃ³n de datos', 'Reclamo', 'Solicitud de informaciÃ³n', 'Cambio de plan', 'RenovaciÃ³n de contrato', 'Baja de servicio', 'Alta de servicio adicional'];
      return details[Math.floor(Math.random() * details.length)];
    },
    randomProcedure() {
      const procedures = ['FacturaciÃ³n', 'Soporte tÃ©cnico', 'Ventas', 'AtenciÃ³n al cliente', 'Legal', 'Contabilidad', 'Recursos Humanos', 'Marketing'];
      return procedures[Math.floor(Math.random() * procedures.length)];
    },
    randomAmount() {
      return '$' + (Math.random() * 10000).toFixed(2);
    },
    randomStatus() {
      return this.estadoOptions[Math.floor(Math.random() * this.estadoOptions.length)];
    },
    randomFollowUp() {
      const followUps = ['Llamada programada', 'Email enviado', 'Esperando respuesta', 'ReuniÃ³n agendada', 'Sin seguimiento'];
      return followUps[Math.floor(Math.random() * followUps.length)];
    },
    showClientBio(row, column, event) {
      if (column === 'Nombre') {
        const clientData = {};
        for (let col of this.columns) {
          clientData[col] = this.getCellValue(row, col);
        }
        clientData.Bio = this.getClientBio(clientData.Nombre);
        clientData.timeline = this.generateRandomTimeline();
        
        clientData.totalProcedures = Math.floor(Math.random() * 50) + 1;
        clientData.totalDue = `$${(Math.random() * 10000).toFixed(2)}`;
        clientData.totalPaid = `$${(Math.random() * 20000).toFixed(2)}`;
        
        clientData.totalProceduresPercentage = (clientData.totalProcedures / 50) * 283;
        clientData.totalDuePercentage = (parseFloat(clientData.totalDue.slice(1)) / 10000) * 283;
        clientData.totalPaidPercentage = (parseFloat(clientData.totalPaid.slice(1)) / 20000) * 283;

        if (event && event.type === 'click') {
          this.fixedClientBio = clientData;
        } else {
          this.hoveredClient = clientData;
        }
      }
    },
    hideClientBio() {
      if (!this.fixedClientBio) {
        this.hoveredClient = null;
      }
    },
    closeFixedBio() {
      this.fixedClientBio = null;
    },
    getClientBio(name) {
      if (!this.clientBios[name]) {
        this.clientBios[name] = this.generateRandomBio(name);
      }
      return this.clientBios[name];
    },
    generateRandomTimeline() {
      const events = [
        { date: '2023-01-15', description: 'Cliente registrado' },
        { date: '2023-02-03', description: 'Primera compra realizada' },
        { date: '2023-03-20', description: 'ActualizaciÃ³n de informaciÃ³n de contacto' },
        { date: '2023-04-12', description: 'Solicitud de soporte tÃ©cnico' },
        { date: '2023-05-28', description: 'RenovaciÃ³n de contrato' }
      ];
      return events.sort((a, b) => new Date(b.date) - new Date(a.date));
    },
    generateRandomBio(name) {
      const industries = ['tecnologÃ­a', 'finanzas', 'salud', 'educaciÃ³n', 'comercio minorista', 'manufactura', 'servicios profesionales'];
      const interests = ['innovaciÃ³n', 'sostenibilidad', 'expansiÃ³n internacional', 'desarrollo de productos', 'mejora de procesos', 'satisfacciÃ³n del cliente'];
      const achievements = ['lÃ­der en su sector', 'ganador de premios de la industria', 'crecimiento constante', 'reconocido por su excelencia en servicio al cliente'];
      
      const industry = industries[Math.floor(Math.random() * industries.length)];
      const interest = interests[Math.floor(Math.random() * interests.length)];
      const achievement = achievements[Math.floor(Math.random() * achievements.length)];
      
      return `${name} es un cliente valioso en la industria de ${industry}. Con un fuerte enfoque en ${interest}, ha logrado ser ${achievement}. Su compromiso con la calidad y la innovaciÃ³n lo convierte en un socio estratÃ©gico para nuestra empresa.`;
    },
    getInitials(name) {
      return name.split(' ').map(n => n[0]).join('').toUpperCase();
    },
    handleTasks(row) {
      this.stickyNoteContent = this.generateRandomTaskNote();
    },
    showStickyNoteHandler() {
      this.showStickyNote = true;
    },
    hideStickyNoteHandler() {
      this.showStickyNote = false;
    },
    generateRandomTaskNote() {
      const tasks = [
        "Llamar al cliente para actualizar informaciÃ³n",
        "Enviar presupuesto por email",
        "Programar reuniÃ³n de seguimiento",
        "Preparar documentaciÃ³n para el trÃ¡mite",
        "Verificar estado del pago pendiente",
        "Actualizar datos en el sistema CRM",
        "Solicitar feedback sobre el servicio prestado",
        "Coordinar entrega de productos",
        "Revisar contrato y enviar para firma",
        "Realizar anÃ¡lisis de satisfacciÃ³n del cliente"
      ];
      return tasks[Math.floor(Math.random() * tasks.length)];
    },
    editClientBio() {
      console.log('Edit client bio:', this.fixedClientBio.Nombre);
    },
    initDashboardChart() {
      if (this.activeItem === 'dashboard') {
        const ctx = document.getElementById('dashboardChart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
            datasets: [{
              label: 'Ingresos',
              data: [12, 19, 3, 5, 2, 3],
              borderColor: 'rgb(75, 192, 192)',
              tension: 0.1
            }, {
              label: 'Gastos',
              data: [7, 11, 5, 8, 3, 7],
              borderColor: 'rgb(255, 99, 132)',
              tension: 0.1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: 'Ingresos vs Gastos'
              }
            }
          }
        });
      }
    },
    initDragAndDrop() {
      const table = document.querySelector('table tbody');
      let draggedRow = null;

      table.addEventListener('dragstart', (e) => {
        draggedRow = e.target.closest('tr');
        e.dataTransfer.setData('text/plain', draggedRow.dataset.rowId);
        setTimeout(() => draggedRow.classList.add('dragging'), 0);
      });

      table.addEventListener('dragend', (e) => {
        e.target.closest('tr').classList.remove('dragging');
      });

      table.addEventListener('dragover', (e) => {
        e.preventDefault();
        const row = e.target.closest('tr');
        if (row && row !== draggedRow) {
          const rect = row.getBoundingClientRect();
          const middleY = rect.top + rect.height / 2;
          if (e.clientY < middleY) {
            row.classList.add('drop-zone');
          } else {
            row.nextElementSibling?.classList.add('drop-zone');
          }
        }
      });

      table.addEventListener('dragleave', (e) => {
        const row = e.target.closest('tr');
        if (row) {
          row.classList.remove('drop-zone');
          row.nextElementSibling?.classList.remove('drop-zone');
        }
      });

      table.addEventListener('drop', (e) => {
        e.preventDefault();
        const row = e.target.closest('tr');
        if (row && row !== draggedRow) {
          const rect = row.getBoundingClientRect();
          const middleY = rect.top + rect.height / 2;
          if (e.clientY < middleY) {
            row.parentNode.insertBefore(draggedRow, row);
          } else {
            row.parentNode.insertBefore(draggedRow, row.nextElementSibling);
          }
          this.updateRowOrder();
        }
        document.querySelectorAll('.drop-zone').forEach(el => el.classList.remove('drop-zone'));
      });
    },
    updateRowOrder() {
      const newOrder = Array.from(document.querySelectorAll('table tbody tr')).map(row => parseInt(row.dataset.rowId));
      this.rows = newOrder;
      this.separatorRows = newOrder.filter(rowId => this.isSeparatorRow(rowId));
      this.recalculateSeparatorSums();
    },
    recalculateSeparatorSums() {
      this.separatorRows.forEach(separatorRowId => {
        this.calculateSeparatorSum(separatorRowId);
      });
    }
  },
  watch: {
    activeItem(newValue) {
      if (newValue === 'dashboard') {
        this.$nextTick(() => {
          this.initDashboardChart();
        });
      }
    }
  },
  mounted() {
    for (let row = 1; row <= this.rows; row++) {
      for (let column of this.columns) {
        this.updateCell(row, column, { target: { textContent: this.generateRandomData(column) } });
      }
    }
    
    const bottomTabs = document.querySelectorAll('.bottom-tabs .tab');
    bottomTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        this.setActiveBottomTab(tab.dataset.tab);
        bottomTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
      });
    });

    document.querySelector('.bottom-tabs .tab[data-tab="mesa"]').classList.add('active');
    this.$nextTick(() => {
      this.initDragAndDrop();
    });
  }
});
</script>
</body></html>